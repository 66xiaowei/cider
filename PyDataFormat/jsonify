"""
Code to convert mat file with structures into json files
Created on : 5/18/15 3:27 PM by rama
"""

import scipy.io as io
import os
import re
import json
import string
import pdb

pathToMat = '/Users/rama/Research/data/pyCider/'
matfile = 'clipart48S.mat'
jsonfile = 'abstract48S.json'

data = io.loadmat(os.path.join(pathToMat, matfile))
refs = list(data['test_clip'][0])

pascal = []

for image in refs:
    for sentences in image[0]:
        for i, sent in enumerate(sentences):
            sent_struct = {}
            imname = str(image[1][0]).split('/')[-1]
            sent_struct['image_id'] = imname
            string_sent = sent[0].strip().split('\\')
            if len(string_sent) == 1:
                sent_struct['caption'] = string_sent[0]
            else:
                sent_struct['caption'] = ' '.join(string_sent[:-1])
            pascal.append(sent_struct)


with open(os.path.join(pathToMat, jsonfile), 'w') as outfile:
    json.dump(pascal, outfile)
